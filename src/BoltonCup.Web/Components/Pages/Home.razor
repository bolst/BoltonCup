@page "/"

@inject IBCData BCData

<HeadContent>
    <meta name="description"
          content="Bolton Cup is back this year: July 18-20 at Tecumseh Arena and the WFCU Centre.">
</HeadContent>


<PageTitle>Bolton Cup</PageTitle>

<div class="home-banner-background">
    <div class="py-6 d-flex align-center justify-center" style="width: 100%; height: 85vh;">
        @if (ShowCountdown)
        {
            <div class="flex-grow-1">
                <Countdown To="_currentTournament?.start_date"/>
            </div>
        }
        else
        {
            <div class="pl-4 pr-lg-4 overflow-scroll">
                <GameTree2025 />
            </div>
        }
    </div>
    
    
    <div class="pa-4 mt-8" style="background-image: linear-gradient(to bottom, #00000000, #000000ff 60%);">
        <MudStack Class="my-1" Justify="Justify.Center" Row>
            <MudText Typo="Typo.h4" Class="white-text" Align="Align.Center"><b>Huge thanks to our sponsors for making this possible!</b></MudText>
        </MudStack>
        <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Wrap="Wrap.Wrap" Spacing="7" Row>
            @foreach (var sponsor in _sponsors)
            {
                <SponsorCard Sponsor="sponsor"/>
            }
        </MudStack>
    </div>
</div>


@code {

    private IEnumerable<BCSponsor> _sponsors = [];
    private BCTournament? _currentTournament;

    private bool _loading;
    private bool _initialized;

    private bool ShowCountdown => !_initialized || (_currentTournament?.start_date is not null && DateTime.Now.Date < _currentTournament.start_date.Value.Date);

    protected override async Task OnInitializedAsync()
    {
        _loading = true;
        StateHasChanged();
        
        _currentTournament = await BCData.GetCurrentTournamentAsync();
        _sponsors = await BCData.GetActiveSponsorsAsync();

        _initialized = true;
        _loading = false;
        StateHasChanged();
    }
}