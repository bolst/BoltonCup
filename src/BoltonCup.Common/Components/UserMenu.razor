@namespace BoltonCup.Common.Components
@inject NavigationManager Navigation
@inject IBoltonCupApi Api

<AuthorizeView>
    <Authorized>
        <MudMenu Label="@context.User.Identity?.Name" 
                 Variant="Variant.Filled" 
                 Color="Color.Primary" 
                 EndIcon="@Icons.Material.Filled.KeyboardArrowDown">
            <MudMenuItem OnClick="GoToProfile">My Profile</MudMenuItem>
            <MudMenuItem OnClick="LogOut">Log Out</MudMenuItem>
        </MudMenu>
    </Authorized>
    <NotAuthorized>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="GoToLogin">Log In</MudButton>
    </NotAuthorized>
</AuthorizeView>

@code {
    
    private void GoToLogin()
    {
        var returnUrl = Uri.EscapeDataString(Navigation.Uri);
        Navigation.NavigateTo($"https://localhost:7269/log-in-or-sign-up?returnUrl={returnUrl}", forceLoad: true);
    }

    private void GoToProfile()
    {
        Navigation.NavigateTo("https://localhost:7269/profile", forceLoad: true);
    }

    private async Task LogOut()
    {
        await Api.LogoutAsync();
        // force refresh to clear state and update UI
        Navigation.NavigateTo(Navigation.Uri, forceLoad: true);
    }
}