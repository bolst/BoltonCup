@page "/tournaments"
@inject ITournamentRepository TournamentRepo

<EntityDataGrid
    T="Tournament"
    ServerFunc="ServerFunc"
    OnSave="OnSave"
    Comparer="_comparer">
    <Columns>
        <PropertyColumn Title="Tournament" Property="x => x.Name" />
        <DatePickerColumn Title="Start" Property="x => x.StartDate ?? DateTime.Now" />
        <DatePickerColumn Title="End" Property="x => x.EndDate ?? DateTime.Now" />
        <BoolColumn Title="Active?" Property="x => x.IsActive" />
        <BoolColumn Title="Registration Open?" Property="x => x.IsRegistrationOpen" />
        <BoolColumn Title="Payment Open" Property="x => x.IsPaymentOpen" />
        <PropertyColumn Title="Skater Limit" Property="x => x.SkaterLimit" />
        <PropertyColumn Title="Goalie Limit" Property="x => x.GoalieLimit" />
        <PropertyColumn Title="Skater Payment Link" Property="x => x.SkaterPaymentLink" />
        <PropertyColumn Title="Goalie Payment Link" Property="x => x.GoaliePaymentLink" />
        <PropertyColumn Title="Winner" Property="x => x.WinningTeamId" />
    </Columns>
</EntityDataGrid>

@code {
    
    private readonly TournamentComparer _comparer = new();

    private async Task<GridData<Tournament>> ServerFunc(GridState<Tournament> state)
    {
        var sortDefinition = state.SortDefinitions.FirstOrDefault();
        var data = await TournamentRepo.GetAllAsync(new GetTournamentsQuery
        {
            Page = state.Page + 1,
            Size = state.PageSize,
            SortBy = sortDefinition?.SortBy,
            Descending = sortDefinition?.Descending ?? false,
        });
        
        var totalItems = data.Items.Count();
        if (data is PaginatedList<Tournament> pageList)
            totalItems = pageList.Total;

        return new GridData<Tournament>
        {
            Items = data.Items,
            TotalItems = totalItems
        };
    }

    private async Task OnSave(HashSet<Tournament> changes)
    {
        
    }
    
}