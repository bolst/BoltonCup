@page "/games"
@inject IGameRepository GameRepo

<EntityDataGrid
    T="Game"
    ServerFunc="ServerFunc"
    OnSave="OnSave"
    Comparer="_comparer">
    <Columns>
        <TeamColumn Title="Home" Property="x => x.HomeTeam" />
        <TeamColumn Title="Away" Property="x => x.AwayTeam" />
        <DatePickerColumn Title="Date" Property="x => x.GameTime"/>
        <PropertyColumn Title="Type" Property="x => x.GameType"/>
        <PropertyColumn Title="Venue" Property="x => x.Venue"/>
        <PropertyColumn Title="Rink" Property="x => x.Rink"/>
        <TournamentColumn Property="x => x.Tournament" />
    </Columns>
</EntityDataGrid>

@code {
    
    private readonly GameComparer _comparer = new();

    private async Task<GridData<Game>> ServerFunc(GridState<Game> state)
    {
        var sortDefinition = state.SortDefinitions.FirstOrDefault();
        var data = await GameRepo.GetAllAsync(new GetGamesQuery
        {
            Page = state.Page + 1,
            Size = state.PageSize,
            SortBy = sortDefinition?.SortBy,
            Descending = sortDefinition?.Descending ?? false,
        });
        
        var totalItems = data.Items.Count();
        if (data is PaginatedList<Game> pageList)
            totalItems = pageList.Total;

        return new GridData<Game>
        {
            Items = data.Items,
            TotalItems = totalItems
        };
    }

    private async Task OnSave(HashSet<Game> changes)
    {
        
    }
    
}