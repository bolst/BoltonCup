@namespace BoltonCup.Auth.Components.Shared
@typeparam T where T : class, new()

@if (!string.IsNullOrEmpty(Title) && AutoFillPageTitle)
{
    <PageTitle>@Title | Bolton Cup</PageTitle>
}

@if (!string.IsNullOrEmpty(Title))
{
    <MudText Typo="Typo.h4">@Title</MudText>
}

<EditForm EditContext="EditContext" OnValidSubmit="HandleValidSubmitAsync" class="mud-width-full">
    <DataAnnotationsValidator />
    @if (_model is not null)
    {
        <MudStack Spacing="6" Class="mud-width-full">
            @foreach (var field in _fields)
            {
                @RenderFieldComponent(field)
            }

            @if (ActionsContent is not null)
            {
                @ActionsContent
            }
            else
            {
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Size="Size.Large" Color="Color.Primary" Disabled="_isSubmitting" FullWidth>Continue</MudButton>
            }
        </MudStack>
    }
</EditForm>



@code {

    private RenderFragment RenderFieldComponent(AutoEditForm.FieldMetadata field)
    {
        var adornment = Adornment.None;
        string? adornmentIcon = null;
        if (field.IsReadOnly && OnEditAdornmentClick.HasDelegate)
        {
            adornment = Adornment.End;
            adornmentIcon = Icons.Material.Rounded.Edit;
        }
        if (field.Type == typeof(string))
        {
            return @<MudTextField Disabled="_isSubmitting"
                                  T="string"
                                  Label="@field.Label"
                                  Value="@((string)field.PropertyInfo.GetValue(_model)!)"
                                  ValueChanged="v => OnValueChanged(field, v)"
                                  For="@(CreateValidationExpression<string>(field))"
                                  ReadOnly="field.IsReadOnly"
                                  InputType="field.InputType"
                                  Adornment="adornment"
                                  AdornmentIcon="@adornmentIcon"
                                  OnAdornmentClick="_ => OnEditAdornmentClick.InvokeAsync(field)"
                                  Variant="Variant.Outlined"
                                  OnlyValidateIfDirty
                                  FullWidth/>;
        }
       
        if (field.Type == typeof(bool))
        {
            return @<MudCheckBox Disabled="_isSubmitting"
                                 T="bool"
                                 Label="@field.Label"
                                 Value="@((bool)field.PropertyInfo.GetValue(_model)!)"
                                 ValueChanged="v => OnValueChanged(field, v)"
                                 For="@(CreateValidationExpression<bool>(field))"
                                 ReadOnly="field.IsReadOnly" />;
        }
        
        return builder => { };
    }

}